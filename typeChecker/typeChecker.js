const st = [
    {
        "TYPE": "BODY",
        "state": [
            {
                "TYPE": "CLASS_DECLARATION",
                "state": [
                    {
                        "TYPE": "KEY_WORD_CLASS",
                        "position": 0,
                        "lexem": "class"
                    },
                    {
                        "TYPE": "ID",
                        "position": 6,
                        "lexem": "main"
                    },
                    {
                        "TYPE": "BODY",
                        "state": [
                            {
                                "TYPE": "OPEN_BRACE",
                                "position": 11,
                                "lexem": "{"
                            },
                            {
                                "TYPE": "VARIABLE_DECLARATION",
                                "state": [
                                    {
                                        "TYPE": "KEY_WORD_VAR",
                                        "position": 17,
                                        "lexem": "var"
                                    },
                                    {
                                        "TYPE": "ID",
                                        "position": 21,
                                        "lexem": "lol"
                                    },
                                    {
                                        "TYPE": "OPERATOR_ASSIGN",
                                        "position": 25,
                                        "lexem": "="
                                    },
                                    {
                                        "TYPE": "INT",
                                        "position": 27,
                                        "lexem": "50"
                                    },
                                    {
                                        "TYPE": "SEMI_COLON",
                                        "position": 29,
                                        "lexem": ";"
                                    },
                                    {
                                        "TYPE": "RETURN_STATEMENT",
                                        "state": [
                                            {
                                                "TYPE": "KEY_WORD_RETURN",
                                                "position": 35,
                                                "lexem": "return"
                                            },
                                            {
                                                "TYPE": "ID",
                                                "position": 42,
                                                "lexem": "lol"
                                            },
                                            {
                                                "TYPE": "SEMI_COLON",
                                                "position": 45,
                                                "lexem": ";"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "TYPE": "CLASS_DECLARATION",
                                "state": [
                                    {
                                        "TYPE": "KEY_WORD_CLASS",
                                        "position": 52,
                                        "lexem": "class"
                                    },
                                    {
                                        "TYPE": "ID",
                                        "position": 58,
                                        "lexem": "hello"
                                    },
                                    {
                                        "TYPE": "BODY",
                                        "state": [
                                            {
                                                "TYPE": "OPEN_BRACE",
                                                "position": 64,
                                                "lexem": "{"
                                            },
                                            {
                                                "TYPE": "VARIABLE_DECLARATION",
                                                "state": [
                                                    {
                                                        "TYPE": "KEY_WORD_VAR",
                                                        "position": 74,
                                                        "lexem": "var"
                                                    },
                                                    {
                                                        "TYPE": "ID",
                                                        "position": 78,
                                                        "lexem": "i"
                                                    },
                                                    {
                                                        "TYPE": "OPERATOR_ASSIGN",
                                                        "position": 80,
                                                        "lexem": "="
                                                    },
                                                    {
                                                        "TYPE": "INT",
                                                        "position": 82,
                                                        "lexem": "50"
                                                    },
                                                    {
                                                        "TYPE": "SEMI_COLON",
                                                        "position": 84,
                                                        "lexem": ";"
                                                    },
                                                    {
                                                        "TYPE": "RETURN_STATEMENT",
                                                        "state": [
                                                            {
                                                                "TYPE": "KEY_WORD_RETURN",
                                                                "position": 94,
                                                                "lexem": "return"
                                                            },
                                                            {
                                                                "TYPE": "ID",
                                                                "position": 101,
                                                                "lexem": "i"
                                                            },
                                                            {
                                                                "TYPE": "SEMI_COLON",
                                                                "position": 102,
                                                                "lexem": ";"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                "TYPE": "CLOSE_BRACE",
                                                "position": 108,
                                                "lexem": "}"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "TYPE": "CLASS_DECLARATION",
                                "state": [
                                    {
                                        "TYPE": "KEY_WORD_CLASS",
                                        "position": 115,
                                        "lexem": "class"
                                    },
                                    {
                                        "TYPE": "ID",
                                        "position": 121,
                                        "lexem": "bue"
                                    },
                                    {
                                        "TYPE": "BODY",
                                        "state": [
                                            {
                                                "TYPE": "OPEN_BRACE",
                                                "position": 125,
                                                "lexem": "{"
                                            },
                                            {
                                                "TYPE": "VARIABLE_DECLARATION",
                                                "state": [
                                                    {
                                                        "TYPE": "KEY_WORD_VAR",
                                                        "position": 135,
                                                        "lexem": "var"
                                                    },
                                                    {
                                                        "TYPE": "ID",
                                                        "position": 139,
                                                        "lexem": "abc"
                                                    },
                                                    {
                                                        "TYPE": "OPERATOR_ASSIGN",
                                                        "position": 143,
                                                        "lexem": "="
                                                    },
                                                    {
                                                        "TYPE": "INT",
                                                        "position": 145,
                                                        "lexem": "50"
                                                    },
                                                    {
                                                        "TYPE": "SEMI_COLON",
                                                        "position": 147,
                                                        "lexem": ";"
                                                    },
                                                    {
                                                        "TYPE": "RETURN_STATEMENT",
                                                        "state": [
                                                            {
                                                                "TYPE": "KEY_WORD_RETURN",
                                                                "position": 157,
                                                                "lexem": "return"
                                                            },
                                                            {
                                                                "TYPE": "ID",
                                                                "position": 164,
                                                                "lexem": "abc"
                                                            },
                                                            {
                                                                "TYPE": "SEMI_COLON",
                                                                "position": 167,
                                                                "lexem": ";"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                "TYPE": "CLOSE_BRACE",
                                                "position": 173,
                                                "lexem": "}"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "TYPE": "CLOSE_BRACE",
                                "position": 175,
                                "lexem": "}"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]


const SCOPES = [

]

const scopeChecker = (state) => {
    state.forEach((TOKEN, index) => {
        if (TOKEN.TYPE === "BODY") {
            SCOPES.push({
                SCOPE_ID: Math.round(Math.random() * 10000000),
                IDENTIFIERS: [],
            })
        }

        // Register declared variable and check 
        // that variable already declared.
        if (TOKEN.TYPE === "KEY_WORD_VAR") {
            const declared_variable = state[index + 1];
            const scope_identifiers = SCOPES[SCOPES.length - 1].IDENTIFIERS;
            const error = `Variable already declared in this scope! Error position ${declared_variable.position}`

            scope_identifiers.forEach((identifier) => {
                if (identifier.lexem === declared_variable.lexem) throw error
            })

            scope_identifiers.push(declared_variable);
        }

        if (TOKEN.state) {
            scopeChecker(TOKEN.state)
        }
    })

}

scopeChecker(st)
console.log(SCOPES)